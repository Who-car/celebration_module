<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>23 Февраля | Special Operation</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Для iOS: разрешаем autoplay -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!-- Отключаем экономию данных которая блокирует видео -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body>

    <!-- 1. КОНТЕЙНЕР ЛОАДЕРА -->
    <div id="terminal-loader">
        <div class="terminal-content">
            <div class="terminal-text"></div>
            <span class="cursor">_</span>
        </div>
    </div>

    <!-- 2. КАПЧА В СТИЛЕ GOOGLE (скрыта по умолчанию) -->
    <div id="captcha-overlay" class="hidden">
        <div class="captcha-modal">
            <div class="captcha-header">
                <span class="captcha-logo">reCAPTCHA</span>
                <button class="captcha-close" onclick="closeCaptcha()">✕</button>
            </div>
            <div class="captcha-body">
                <div class="captcha-instruction">Выберите все фрагменты в правильном порядке</div>
                
                <!-- Пазл -->
                <div id="puzzle-grid"></div>
                
                <!-- Видео (скрыто до решения пазла) -->
                <div id="captcha-video-container" class="hidden">
                    <div id="video-overlay" class="video-overlay">
                        <div class="video-start-prompt">
                            <div class="play-icon">▶</div>
                            <p>Нажмите для воспроизведения</p>
                        </div>
                    </div>
                    <video id="captcha-video" playsinline webkit-playsinline muted>
                        <source src="assets/captcha.mp4" type="video/mp4">
                        Ваш браузер не поддерживает видео
                    </video>
                </div>
                
                <!-- Успех (скрыто до конца видео) -->
                <div id="captcha-success" class="hidden">
                    <div class="success-checkmark">
                        <svg viewBox="0 0 52 52" class="checkmark">
                            <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                            <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                        </svg>
                    </div>
                    <p>Подтверждено</p>
                </div>
            </div>
            <div class="captcha-footer">
                <div class="captcha-branding">
                    <img src="https://www.gstatic.com/recaptcha/api2/logo_48.png" alt="reCAPTCHA">
                    <span>Privacy - Terms</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. КОНТЕЙНЕР ИГРЫ (скрыт по умолчанию) -->
    <div id="game-container" class="hidden">
        <canvas id="game-canvas"></canvas>
        
        <!-- Мобильное управление -->
        <div class="mobile-controls" id="mobile-controls">
            <div class="dpad">
                <button class="dpad-btn up" data-key="ArrowUp">▲</button>
                <button class="dpad-btn left" data-key="ArrowLeft">◀</button>
                <button class="dpad-btn right" data-key="ArrowRight">▶</button>
                <button class="dpad-btn down" data-key="ArrowDown">▼</button>
            </div>
            <button class="fire-btn" data-key=" ">●</button>
        </div>
    </div>

    <!-- 4. МОДАЛКА ПОЗДРАВЛЕНИЯ (скрыта) -->
    <div id="congrats-modal" class="modal hidden">
        <div class="modal-content">
            <img id="congrats-img" src="" alt="Congrats">
            <h2 id="congrats-text"></h2>
            <button onclick="openLootboxScene()">Получить подарок</button>
        </div>
    </div>

    <!-- 5. СЦЕНА ЛУТБОКСА (скрыта) -->
    <div id="lootbox-scene" class="hidden">
        <h2>REWARD PROTOCOL ACTIVE</h2>
        <div class="lootbox-wrapper">
            <div class="lootbox">
                <div class="selector"></div>
                <div class="lootbox-items" id="lootbox-items"></div>
            </div>
        </div>
        <button id="spin-btn" onclick="spinLootbox()">ОТКРЫТЬ</button>
    </div>

    <!-- 6. ФИНАЛЬНЫЙ ЭКРАН (скрыт) -->
    <div id="final-prize" class="modal hidden">
        <div class="modal-content">
            <div class="copy-toast">Скопировано в буфер обмена</div>
            <button class="final-close" onclick="closeFinalPrize()">✕</button>
            <h2>ПОЗДРАВЛЯЕМ!</h2>
            <img src="assets/certificate.jpg" alt="Certificate" class="certificate-img">
            <p id="final-prize-text">Твой подарок на 23 февраля!</p>
            <p>Активируйте через 'Игры' → 'Активировать в Steam'. Активируйте код до 18 февраля 2027</p>
            <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ&list=RDdQw4w9WgXcQ&start_radio=1" target="_blank" class="get-prize-btn">
                ПОЛУЧИТЬ СЕРТИФИКАТ
            </a>
        </div>
    </div>

    <!-- Подключаем скрипты (порядок важен!) -->
    <script src="js/loader.js"></script>
    <script src="js/captcha.js"></script>
    <script src="js/game.js"></script>
    <script src="js/lootbox.js"></script>
    <script src="js/main.js"></script>
</body>
</html>